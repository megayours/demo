(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{4451:function(e,t,a){Promise.resolve().then(a.bind(a,2577))},8925:function(e,t,a){"use strict";a.d(t,{h:function(){return n}});var o=a(8037);let n={getNFT:async(e,t,a,o)=>{let n=await e.query("yours.metadata",{project:t,collection:a,token_id:o});if(null!=n)return{token_id:o,metadata:n,blockchain:"Fishing Game",project:n.yours.project,collection:n.yours.collection}},getPudgyRods:async e=>e.query("pudgy.get_rods",{}),equipRod:async(e,t,a)=>{let n={operations:[(0,o.op)("pudgy.equip_fishing_rod",t,a),(0,o.WY6)()],signers:[]};await e.sendTransaction(n)},unequipRod:async(e,t)=>{let a={operations:[(0,o.op)("pudgy.unequip_fishing_rod",t),(0,o.WY6)()],signers:[]};await e.sendTransaction(a)},pullFish:async(e,t)=>{let a={operations:[(0,o.op)("pudgy.pull_fish",t),(0,o.WY6)()],signers:[]};await e.sendTransaction(a)}}},1229:function(e,t,a){"use strict";a.d(t,{ContextProvider:function(){return c},T:function(){return l}});var o=a(7437),n=a(2265),i=a(4984),r=a(8353);let s=(0,n.createContext)({sessions:{},setSession:()=>{},logout:async()=>{},isLoading:!0});function l(){return(0,n.useContext)(s)}function c(e){let{children:t}=e,[a,l]=(0,n.useState)({}),[c,d]=(0,n.useState)(!0),u=(0,n.useRef)({}),g=(0,n.useCallback)((e,t,a)=>{console.log("Setting session for blockchainRid: ".concat(e),t),l(a=>{if(void 0===t){let{[e]:t,...o}=a;return o}return{...a,[e]:t}}),t&&a?(u.current[e.toUpperCase()]=a,localStorage.setItem("session_".concat(e.toUpperCase()),"true")):(delete u.current[e.toUpperCase()],localStorage.removeItem("session_".concat(e.toUpperCase())))},[]),h=(0,n.useCallback)(async e=>{console.log("Handle logout for blockchainRid: ".concat(e));try{let t=u.current[e.toUpperCase()];if(t){let e=t();e instanceof Promise&&await e,console.log("Logout function executed successfully")}else console.warn("No logout function found for blockchainRid: ".concat(e));l(t=>{let{[e]:a,...o}=t;return o}),delete u.current[e.toUpperCase()],localStorage.removeItem("session_".concat(e.toUpperCase())),console.log("Session and logout function removed")}catch(e){console.error("Error during logout:",e)}},[]);return(0,n.useEffect)(()=>{(async()=>{d(!0);try{console.log("Attempting auto-login...");let e=await (0,r.Z)();if(localStorage.getItem("session_".concat(e.config.blockchainRid.toUpperCase()))){console.log("Found persisted session data, recreating session");let{session:t,logout:a}=await (0,i.e)(!0);t?(console.log("Session recreated successfully"),l({[e.config.blockchainRid.toUpperCase()]:t}),u.current[e.config.blockchainRid.toUpperCase()]=a):(console.log("Failed to recreate session, removing persisted data"),localStorage.removeItem("session_".concat(e.config.blockchainRid.toUpperCase())))}else{console.log("No persisted session found, creating new session");let{session:t,logout:a}=await (0,i.e)(!0);t?(console.log("New session created successfully"),l({[e.config.blockchainRid.toUpperCase()]:t}),u.current[e.config.blockchainRid.toUpperCase()]=a,localStorage.setItem("session_".concat(e.config.blockchainRid.toUpperCase()),"true")):console.log("Failed to create new session")}}catch(e){console.error("Failed to auto-login:",e)}finally{d(!1)}})()},[]),(0,n.useEffect)(()=>{console.log("Current sessions:",a),console.log("Logout functions available:",Object.keys(u.current))},[a]),(0,o.jsx)(s.Provider,{value:{sessions:a,setSession:g,logout:h,isLoading:c},children:t})}},2639:function(e,t,a){"use strict";var o=a(7437),n=a(6648);a(2265);var i=a(1471);let r=e=>{switch(e.toLowerCase()){case"ethereum":return"from-blue-500 via-blue-400 to-blue-300";case"mega chain":return"from-purple-600 via-purple-500 to-purple-400";case"fishing game":return"from-green-500 via-green-400 to-green-300";default:return"from-gray-500 via-gray-400 to-gray-300"}},s=e=>{switch(e.toLowerCase()){case"fishes caught":case"fishing rod":case"equipped by":case"durability":return"bg-green-500";case"recent mega chain visit":return"bg-purple-600";default:return"bg-gray-700"}};t.Z=e=>{let{imageUrl:t,tokenName:a,tokenDescription:l,metadata:c,blockchain:d,isGamePage:u=!1,actions:g=[]}=e,h=(e,t)=>(0,o.jsxs)("div",{className:"".concat(s(e.trait_type)," rounded-lg p-2 text-xs"),children:[(0,o.jsxs)("span",{className:"font-semibold",children:[e.trait_type,":"]})," ",e.value]},"".concat(e.trait_type,"-").concat(t)),m=u?c.attributes.filter(e=>["Fishes Caught","Fishing Rod"].includes(e.trait_type)):c.attributes;return(0,o.jsxs)("div",{className:"bg-[var(--color-card)] rounded-lg shadow-xl overflow-hidden transition-transform duration-300 hover:scale-105 max-w-sm mx-auto",children:[(0,o.jsx)("div",{className:"relative w-full h-64",children:(0,o.jsx)(n.default,{src:t,alt:a,fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",style:{objectFit:"cover"},className:"rounded-t-lg",priority:!0})}),(0,o.jsxs)("div",{className:"p-4",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:a}),(0,o.jsx)("div",{className:"inline-block bg-gradient-to-r ".concat(r(d)," text-white text-xs font-semibold px-2 py-1 rounded-full mb-2"),children:d}),(0,o.jsx)("p",{className:"text-gray-300 text-sm line-clamp-3 mb-4",children:l}),(0,o.jsx)("div",{className:"mb-4",children:(0,o.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:m.map((e,t)=>h(e,t))})}),g.length>0&&(0,o.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:g.map((e,t)=>(0,o.jsx)("button",{onClick:e.onClick,className:"mega-button text-sm relative",disabled:e.loading,children:e.loading?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"opacity-0",children:e.label}),(0,o.jsx)("span",{className:"absolute inset-0 flex items-center justify-center",children:(0,o.jsx)(i.Z,{size:"medium"})})]}):e.label},t))})]})]})}},1471:function(e,t,a){"use strict";var o=a(7437);a(2265),t.Z=e=>{let{size:t="medium"}=e,a={small:"border-[1px]",medium:"border-2",large:"border-3"},n={small:"inset-[2px]",medium:"inset-1",large:"inset-1.5"};return(0,o.jsxs)("div",{className:"".concat({small:"h-4 w-4",medium:"h-8 w-8",large:"h-12 w-12"}[t]," relative"),children:[(0,o.jsx)("div",{className:"absolute inset-0 rounded-full animate-spin-slow ".concat(a[t]," border-transparent"),children:(0,o.jsx)("div",{className:"h-full w-full bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 rounded-full ".concat({small:"blur-[1px]",medium:"blur-[2px]",large:"blur-[3px]"}[t]," opacity-75")})}),(0,o.jsx)("div",{className:"absolute ".concat(n[t]," bg-[var(--color-background)] rounded-full")}),(0,o.jsx)("div",{className:"absolute ".concat(n[t]," rounded-full animate-spin ").concat(a[t]," border-transparent"),children:(0,o.jsx)("div",{className:"h-full w-full bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 rounded-full"})})]})}},2577:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var o=a(7437),n=a(2265),i=a(6463),r=a(2639),s=a(1471),l=a(8037);let c={getNFT:async(e,t,a,o)=>{var n,i;let r=await e.query("yours.metadata",{project:t,collection:a,token_id:o});return{token_id:o,metadata:r,blockchain:"Mega Chain",project:(null===(n=r.yours)||void 0===n?void 0:n.project)||"MISSING",collection:(null===(i=r.yours)||void 0===i?void 0:i.collection)||"MISSING"}},getNFTs:async e=>(await e.query("importer.get_tokens")).map(e=>{var t,a;return{...e,blockchain:"Mega Chain",project:(null===(t=e.metadata.yours)||void 0===t?void 0:t.project)||"MISSING",collection:(null===(a=e.metadata.yours)||void 0===a?void 0:a.collection)||"MISSING"}}),importNFT:async(e,t,a,o,n)=>{await e.call((0,l.op)("importer.import_token",[n.name,n.attributes.map(e=>[e.trait_type,e.value]),[[],t,a],n.description,n.image,null],o))}},d={getGatewayUrl:e=>{let t="ipfs://";if(e.startsWith(t)){let a=e.slice(t.length);return"https://ipfs.io/ipfs/".concat(a)}return e},fetchNFTMetadata:async e=>{let t=await fetch(d.getGatewayUrl(e)),a=await t.json();return{image:d.getGatewayUrl(a.image),name:a.name,description:a.description,attributes:a.attributes}}},u="TheIglooCompany",g=[8109,8110,8111,8112,8113,8114],h=[1447,8400,706,8225,3525,6610],m={getNFTs:async()=>[...await Promise.all(g.map(async e=>{let t=await d.fetchNFTMetadata("".concat("ipfs://bafybeibc5sgo2plmjkq2tzmhrn54bk3crhnc23zd2msg4ea7a4pxrkgfna","/").concat(e));return{token_id:e,metadata:t,blockchain:"Ethereum",project:u,collection:"Pudgy Penguins"}})),...await Promise.all(h.map(async e=>{let t=await d.fetchNFTMetadata("".concat("https://api.pudgypenguins.io/present","/").concat(e)),a={...t,attributes:[t.attributes]};return console.log("fixedMetadata",a),{token_id:e,metadata:a,blockchain:"Ethereum",project:u,collection:"Pudgy Rods"}}))]};var p=a(1229),f=a(9659);let b=a(357).env.NEXT_PUBLIC_D1_NODE_URL_POOL||"http://localhost:7740",y={};async function w(e){let t;if(y[e])return y[e];let a=await (0,f.eI)({nodeUrlPool:[b],blockchainRid:e}),o=await (0,l.nxA)(window.ethereum),n=(0,l._zT)(a,o),i=await n.getAccounts(),r=i[0];if(i.length>0){let{session:e}=await n.login({accountId:r.id,config:{rules:(0,l.mm6)((0,l.i4F)(1)),flags:["MySession"]}});t=e}else{let e=(0,l.Wh)(["A","T"],o.id),{session:n}=await (0,l.UDE)(a,o,l.SCz.open(e,{config:{rules:(0,l.mm6)((0,l.i4F)(1)),flags:["MySession"]}}));t=n}return y[e]=t,t}async function x(e,t,a,o,n){if(!e)return;let i=await w(n),r=await e.query("yours.metadata",{project:t,collection:a,token_id:o});await e.transactionBuilder().add((0,l.op)("yours.init_transfer",e.account.id,t,a,o,1,r),{onAnchoredHandler:async e=>{if(!e)throw Error("No data provided");let t=await e.createProof(i.blockchainRid);await i.transactionBuilder().add(t,{authenticator:l.wSQ}).add((0,l.op)("yours.apply_transfer",e.tx,e.opIndex),{authenticator:l.wSQ}).buildAndSend()}}).buildAndSendWithAnchoring()}async function v(e,t,a,o,n){if(!e)return;let i=await w(n),r=await i.query("yours.metadata",{project:t,collection:a,token_id:o});await i.transactionBuilder().add((0,l.op)("yours.init_transfer",i.account.id,t,a,o,1,r),{onAnchoredHandler:async t=>{if(!t)throw Error("No data provided");let a=await t.createProof(e.blockchainRid);await e.transactionBuilder().add(a,{authenticator:l.wSQ}).add((0,l.op)("yours.apply_transfer",t.tx,t.opIndex),{authenticator:l.wSQ}).buildAndSend()}}).buildAndSendWithAnchoring()}var k=a(8925),N=a(2755),_=e=>{let{isOpen:t,onClose:a,children:n}=e;return t?(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:(0,o.jsxs)("div",{className:"modal-content bg-gradient-to-br from-[var(--color-surface)] to-[var(--color-background)] rounded-lg p-6 max-w-sm w-full border border-[var(--color-primary)] shadow-lg",children:[(0,o.jsx)("div",{className:"flex justify-end",children:(0,o.jsx)("button",{onClick:a,className:"text-[var(--color-text)] hover:text-[var(--color-primary)] transition-colors duration-300",children:"\xd7"})}),n]})}):null},j=a(8353),C=function(){let[e,t]=(0,n.useState)([]),[a,l]=(0,n.useState)(!0),[d,u]=(0,n.useState)({}),{sessions:g}=(0,p.T)(),[h,f]=(0,n.useState)(),b=(0,i.useRouter)(),[y,w]=(0,n.useState)(null),[C,F]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{f(g[(await (0,j.Z)()).config.blockchainRid.toUpperCase()])})()},[g]),(0,n.useEffect)(()=>{h&&S()},[h]);let S=async()=>{if(h){l(!0);try{let e=await m.getNFTs(),a=await c.getNFTs(h),o=await (0,N.Z)();console.log("External NFTs: ".concat(JSON.stringify(e))),console.log("Mega Yours NFTs: ".concat(JSON.stringify(a)));let n=[];for(let t of(n.push(...e),a)){let e=n.findIndex(e=>e.token_id===t.token_id);-1!==e?n[e]={metadata:t.metadata,blockchain:t.blockchain,token_id:t.token_id,project:t.project,collection:t.collection}:n.push(t)}for(let e of a){let t=await k.h.getNFT(o,e.project,e.collection,e.token_id);if(console.log("Fishing Game NFT: ".concat(JSON.stringify(t))),t){let a=n.findIndex(t=>t.token_id===e.token_id);-1!==a&&(console.log("Updating NFT as Fishing one"),n[a]={metadata:t.metadata,blockchain:t.blockchain,token_id:e.token_id,project:e.project,collection:e.collection})}}t(n)}catch(e){console.error("Error fetching NFTs:",e)}finally{l(!1)}}},T=e=>{t(t=>t.map(t=>t.token_id===e.token_id?e:t))},I=(e,t,a)=>{u(o=>({...o,["".concat(e,"-").concat(t)]:a}))},U=async(e,t,a,o)=>{if(h){I(a,"import",!0);try{await c.importNFT(h,e,t,a,o);let n=await c.getNFT(h,e,t,a);n?T(n):console.error("Failed to fetch updated NFT data after import")}catch(e){console.error("Error importing token:",e)}finally{I(a,"import",!1)}}},E=async(e,t,a)=>{if(h){I(a,"bridgeToFishing",!0);try{let o=await (0,N.Z)();await x(h,e,t,a,o.config.blockchainRid),await new Promise(e=>setTimeout(e,5e3));let n=await k.h.getNFT(o,e,t,a);n&&T({...n,token_id:a,collection:t})}catch(e){console.error("Error bridging token to Fishing Game:",e)}finally{I(a,"bridgeToFishing",!1)}}},R=async(e,t,a)=>{if(h){I(a,"bridgeFromFishing",!0);try{let o=await (0,j.Z)();await v(h,e,t,a,o.config.blockchainRid),await new Promise(e=>setTimeout(e,5e3));let n=await c.getNFT(h,e,t,a);n&&T(n)}catch(e){console.error("Error bridging token from Fishing Game:",e)}finally{I(a,"bridgeFromFishing",!1)}}},P=async e=>{b.push("/game?project=".concat(e.project,"&collection=").concat(e.collection,"&tokenId=").concat(e.token_id))},M=e=>{w(e),F(!0)},A=()=>{F(!1),w(null)},L=async e=>{if(!y||!h)return;let{project:t,collection:a,token_id:o}=y;I(o,"bridge",!0);try{"Ethereum"===y.blockchain&&"Mega Chain"===e?await U(t,a,o,y.metadata):"Mega Chain"===y.blockchain&&"Fishing Game"===e?await E(t,a,o):"Fishing Game"===y.blockchain&&"Mega Chain"===e&&await R(t,a,o)}catch(e){console.error("Error bridging token:",e)}finally{I(o,"bridge",!1),A()}},G=e=>{let t=[];return t.push({label:"Bridge",onClick:()=>M(e),loading:d["".concat(e.token_id,"-bridge")]||!1}),"Fishing Game"===e.blockchain&&"Pudgy Penguins"===e.collection&&t.push({label:"Play",onClick:()=>P(e),loading:!1}),t};return a?(0,o.jsx)("div",{className:"container mx-auto px-4 py-8 flex justify-center items-center h-screen",children:(0,o.jsx)(s.Z,{size:"large"})}):(0,o.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,o.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:e.filter(e=>{var t;return null==e?void 0:null===(t=e.metadata)||void 0===t?void 0:t.image}).map((e,t)=>(0,o.jsx)(r.Z,{imageUrl:e.metadata.image||"",tokenName:e.metadata.name,tokenDescription:e.metadata.description,metadata:e.metadata,actions:G(e),blockchain:e.blockchain},"".concat(e.token_id,"-").concat(e.blockchain)))}),(0,o.jsx)(_,{isOpen:C,onClose:A,children:y&&(0,o.jsxs)("div",{className:"p-4",children:[(0,o.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Select a target blockchain"}),(0,o.jsxs)("div",{className:"space-y-2",children:["Ethereum"===y.blockchain&&(0,o.jsx)("button",{className:"w-full bg-blue-500 text-white py-2 px-4 rounded",onClick:()=>L("Mega Chain"),children:"Mega Chain"}),"Mega Chain"===y.blockchain&&(0,o.jsx)("button",{className:"w-full bg-green-500 text-white py-2 px-4 rounded",onClick:()=>L("Fishing Game"),children:"Fishing Game"}),"Fishing Game"===y.blockchain&&(0,o.jsx)("button",{className:"w-full bg-purple-500 text-white py-2 px-4 rounded",onClick:()=>L("Mega Chain"),children:"Mega Chain"})]})]})})]})}},4984:function(e,t,a){"use strict";a.d(t,{e:function(){return i}});var o=a(8037),n=a(8353);async function i(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!window.ethereum)return console.error("Ethereum not found on window"),{session:void 0,logout:()=>{}};let t=await (0,n.Z)(),a=await (0,o.nxA)(window.ethereum),i=(0,o._zT)(t,a),r=await i.getAccounts(),s=(0,o.U7w)();if(r.length>0){let t=r[0].id;if(e){let e=await s.getKeyStore(t);if(!(null==e?void 0:e.pubKey))return{session:void 0,logout:()=>{}};{let{session:e,logout:a}=await i.login({accountId:t,loginKeyStore:s,config:{rules:(0,o.mm6)((0,o.i4F)(2)),flags:["MySession"]}});return{session:e,logout:()=>{a(),console.log("Logging out...")}}}}let{session:a,logout:n}=await i.login({accountId:t,loginKeyStore:s,config:{rules:(0,o.mm6)((0,o.i4F)(2)),flags:["MySession"]}});return{session:a,logout:()=>{n(),console.log("Logging out...")}}}if(!e){let e=(0,o.Wh)(["A","T"],a.id),{session:n,logout:i}=await (0,o.UDE)(t,a,o.SCz.open(e,{config:{rules:(0,o.mm6)((0,o.i4F)(2)),flags:["MySession"]}}));return{session:n,logout:()=>{i(),console.log("Logging out...")}}}return{session:void 0,logout:()=>{}}}},2755:function(e,t,a){"use strict";let o;var n=a(9659),i=a(357);let r=i.env.NEXT_PUBLIC_D1_NODE_URL_POOL||"http://localhost:7740",s=i.env.NEXT_PUBLIC_MEGA_CHAIN_BLOCKCHAIN_RID;async function l(){if(o)return o;let e={directoryNodeUrlPool:r};return s?e.blockchainRid=s:e.blockchainIid=2,o=await (0,n.eI)(e)}t.Z=l},8353:function(e,t,a){"use strict";let o;var n=a(9659),i=a(357);let r=i.env.NEXT_PUBLIC_D1_NODE_URL_POOL||"http://localhost:7740",s=i.env.NEXT_PUBLIC_MEGA_CHAIN_BLOCKCHAIN_RID;async function l(){if(o)return o;let e={directoryNodeUrlPool:r};return s?e.blockchainRid=s:e.blockchainIid=1,o=await (0,n.eI)(e)}t.Z=l}},function(e){e.O(0,[999,233,595,971,23,744],function(){return e(e.s=4451)}),_N_E=e.O()}]);